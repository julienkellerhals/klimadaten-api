{% extends 'base.html' %}
{% block title %}Admin{% endblock %}

{% block head %}
{{ super() }}
<style>
    #adminContainer {
        height: 100%;
        display: flex;
        align-items: stretch;
    }

    #serverLog {
        flex-grow: 2;
    }

    #panel {
        flex-grow: 1;
    }

    #panelContainer {
        padding: 0em 2em;
        display: flex;
        flex-direction: column;
    }

    .service {
        height: 2em;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .dot {
        height: 25px;
        width: 25px;
        background-color: #bbb;
        border-radius: 50%;
        display: inline-block;
    }

    .success {
        background-color: green;
    }

    .error {
        background-color: red;
    }
</style>
{% endblock %}

{% block container %}
<div id="adminContainer">
    <div id="serverLog">
        <h1>Server Log</h1>
        Add server log here
    </div>
    <div id="panel">
        <h1>Panel</h1>
        <h3>Running services</h3>
        <div id="panelContainer">
            <div class="service" id="driverLoc">
                Driver missing / found
                <span class="dot"></span>
            </div>
            <div class="service" id="driverStatus">
                Webdriver status
                <span class="dot"></span>
            </div>
            <div class="service" id="engineStatus">
                Database engine status
                <span class="dot"></span>
            </div>
            <div class="service">
                More to be added
                <span class="dot"></span>
            </div>
            <script>
                function getEngineStatus() {
                    var engineEventSource = new EventSource("/admin/getEngineStatus")
                    engineEventSource.onmessage = function (e) {
                        if (e.data.split(";")[0] == "Status: 1") {
                            document.getElementById("engineStatus").lastElementChild.classList.remove("success")
                            document.getElementById("engineStatus").lastElementChild.classList.add("error")
                        } else if (e.data.split(";")[0] == "Status: 0") {
                            document.getElementById("engineStatus").lastElementChild.classList.remove("error")
                            document.getElementById("engineStatus").lastElementChild.classList.add("success")
                        }
                    };
                }
                function getDriverStatus() {
                    var driverEventSource = new EventSource("/admin/getDriverStatus")
                    driverEventSource.onmessage = function (e) {
                        if (e.data.split(";")[0] == "Status: 1") {
                            document.getElementById("driverStatus").lastElementChild.classList.remove("success")
                            document.getElementById("driverStatus").lastElementChild.classList.add("error")
                        } else if (e.data.split(";")[0] == "Status: 0") {
                            document.getElementById("driverStatus").lastElementChild.classList.remove("error")
                            document.getElementById("driverStatus").lastElementChild.classList.add("success")
                        }
                    };
                }
                // TODO system is appending additional event source, wait until event source is close before starting new one
                // setInterval(getEngineStatus, 10000);
                getEngineStatus();
                getDriverStatus();
            </script>
        </div>
    </div>
</div>
{% endblock %}